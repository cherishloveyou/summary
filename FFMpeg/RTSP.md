## RTSP

```shell
通过RTP传输高清h264码流时，当码流的分辨率为1080P，在网络上传输过程中，瞬时的码率峰值可能会超过系统默认的udp的缓冲区大小，导致解码数据不完整，看到花屏的视频。
推流端视频包大小不一，发包频繁，最终导致在接收端MTU端，被分包，导致丢帧.
```

```
增加udp连接方式缓冲区减少丢包

用udp传输的情况下 将udp.c中的UDP_MAX_PKT_SIZE 缩小10倍，再将编译好的ffmpeg库拿来用，则会发现花屏更加剧烈。于是将UDP_MAX_PKT_SIZE放大10倍，则基本上很难再出现花屏现象。
 
#define UDP_TX_BUF_SIZE 32768
#define UDP_MAX_PKT_SIZE (65536*10)
#define UDP_HEADER_SIZE 8

多线程处理
测试过av_read_frame的耗时-发现在25帧/秒 4M比特流的情况下，av_read_frame耗时30~40ms，而解码也需要10ms左右，这就决定了1秒以内难以完成读取视频和解码视频的操作，即便是缓冲也不行，因为平均时间=25*(30~40+10)>1000ms。所以需要将读取rtsp码流作为一个线程，解码作为一个线程。下面是我封装好的存储rtsp线程码流的类
```




